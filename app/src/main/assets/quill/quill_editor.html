<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Quill Editor</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="https://cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet" />

    <style>
        html, body {
          height: 100%;
          margin: 0;
          display: flex;
          flex-direction: column;
        }

        #editor-container {
          display: flex;
          flex-direction: column;
          height: 100%;
        }

        #toolbar {
          position: relative;
          display: flex;
          align-items: center;
          gap: 10px;
          padding: 8px;
          background-color: #f5f5f5;
          border-bottom: 1px solid #ccc;
          overflow: visible;
        }

        #toolbar-scroll {
          display: flex;
          flex-wrap: nowrap;
          overflow-x: auto;
          overflow-y: hidden;
          white-space: nowrap;
          gap: 10px;
          flex: 1 1 auto;   /* take available space */
          min-width: 0;     /* allow to shrink */
        }

        #toolbar > .ql-formats {
          flex-shrink: 0;  /* pickers donâ€™t shrink */
          display: flex;
          align-items: center;
          gap: 8px;
        }

        #toolbar-scroll .ql-formats {
          display: flex;
          align-items: center;
          gap: 8px;
        }

        #toolbar-scroll button {
          width: 25px;
          height: 25px;
          display: flex;
          justify-content: center;
          align-items: center;
          font-size: 15px;
          padding: 0;
          border: none;
          background: transparent;
          cursor: pointer;
          transition: background-color 0.2s ease;
          color: #444;
        }

        #toolbar-scroll button:hover {
          background-color: #e0e0e0;
          border-radius: 4px;
        }

        #toolbar select {
          padding: 5px 8px;
          font-size: 1.1em;
          min-width: 80px;
          height: 32px;
          border-radius: 4px;
          border: 1px solid #ccc;
          background-color: #fff;
          cursor: pointer;
        }

        #toolbar select.ql-size,
        #toolbar select.ql-font {
          min-width: 100px;
        }

        .ql-toolbar.ql-snow + .ql-container.ql-snow {
          border-top: 0px;
        }

        .ql-container {
          flex: 1;
          display: flex;
          flex-direction: column;
        }

        .ql-editor {
          flex-grow: 1;
          overflow-y: auto;
          padding: 12px;
          min-height: 500px;
        }

        .ql-picker,
        .ql-picker-options {
          z-index: 2000;
        }
    </style>
</head>

<body>
<div id="editor-container">
    <div id="toolbar">
        <div id="toolbar-scroll">
        <span class="ql-formats">
          <button class="ql-bold"></button>
          <button class="ql-italic"></button>
          <button class="ql-underline"></button>
          <button class="ql-strike"></button>
          <button class="ql-list" value="ordered"></button>
          <button class="ql-list" value="bullet"></button>
          <button class="ql-image"></button>
        </span>
        </div>

        <span class="ql-formats">
        <select class="ql-font"></select>
        <select class="ql-size"></select>
        <select class="ql-color"></select>
        <select class="ql-background"></select>
        <select class="ql-align"></select>
      </span>
    </div>

    <div id="editor"></div>
</div>

<script src="https://cdn.quilljs.com/1.3.7/quill.min.js"></script>
<script>
    const quill = new Quill('#editor', {
      theme: 'snow',
      modules: {
        toolbar: '#toolbar'
      }
    });

    quill.getModule('toolbar').addHandler('image', () => {
      if (typeof AndroidInterface !== 'undefined' && AndroidInterface.requestImage) {
        AndroidInterface.requestImage();
      } else {
        console.warn("AndroidInterface.requestImage is not defined. Ensure your Android WebView setup is correct for image selection.");
        const imageUrl = prompt("Enter image URL:");
        if (imageUrl) {
          insertImageFromAndroid(imageUrl);
        }
      }
    });

    function insertImageFromAndroid(imageData) {
      const range = quill.getSelection(true);
      quill.insertEmbed(range.index, 'image', imageData);
      quill.setSelection(range.index + 1);
    }

    function sendContentToAndroid() {
      if (typeof AndroidInterface !== 'undefined' && AndroidInterface.onContent) {
        AndroidInterface.onContent(quill.root.innerHTML);
      } else {
        console.warn("AndroidInterface.onContent is not defined. Make sure your Android WebView is correctly set up.");
      }
    }

    function getHtmlContent() {
      return quill.root.innerHTML;
    }
</script>
</body>
</html>
